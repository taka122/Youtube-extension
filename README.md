# YouTube: 再生前に「なぜ見るのか」入力

YouTube の視聴前に目的意識を促すためのユーザースクリプトです。動画の再生前に理由入力を求め、学習とそれ以外の視聴時間を自動で集計します。ショート動画のブロックや、任意の視聴時間制限など集中のためのオプションも備えています。

## 主な機能
- 再生前にカテゴリと視聴理由の入力を必須化（最小文字数は設定可能）
- 入力内容を基に「学習」「娯楽」「その他」の視聴時間を日別で自動計測
- その日の合計視聴時間を常時表示するオーバーレイと、履歴を一覧できる集計パネル
- 学習以外の視聴時間に任意の1日上限を設定し、超過時に再生をブロック
- YouTube Shorts の自動ブロック／リダイレクト、および関連 UI の非表示
- PC 版 / モバイル版（`m.youtube.com`）どちらでも動作

## 動作要件
- 最新の Chromium / Firefox 系ブラウザ
- ユーザースクリプトマネージャ（Tampermonkey, Violentmonkey, Userscripts など）

## インストール
1. ユーザースクリプトマネージャで新規スクリプトを作成します。
2. `youtube_reason.user.js` の内容をコピーし、管理ツールに貼り付けて保存します。
3. スクリプトを有効化した状態で YouTube を開いて動作を確認してください。

## 使い方
- YouTube で動画を開くと再生前にモーダルが表示されます。カテゴリ（学習／作業／娯楽／その他）と視聴理由を入力すると再生が許可されます。
- 同じ動画へ戻った場合は前回の入力が自動的に承認され、すぐ再生できます。
- 画面右上にその日の視聴時間を示すオーバーレイが表示されます。「集計」ボタンから日別サマリーと直近の理由履歴を確認できます。
- Shorts にアクセスすると設定に応じてブロック／リダイレクトされます。

## 設定
スクリプト冒頭の `CONFIG` オブジェクトを編集して挙動を調整できます。

| 設定キー | 説明 | 既定値 |
| --- | --- | --- |
| `ENABLE_NON_LEARNING_LIMIT` | 学習以外カテゴリの 1 日視聴時間に上限を設けるかどうか | `false` |
| `NON_LEARNING_LIMIT_MIN` | 学習以外カテゴリの視聴時間上限（分） | `30` |
| `MIN_REASON_LEN` | 理由入力の最小文字数 | `5` |
| `MODAL_WIDTH` | 理由入力モーダルの最大幅（px） | `520` |
| `BLOCK_SHORTS` | Shorts 動画への遷移をブロックする | `true` |
| `HIDE_SHORTS_UI` | Shorts 関連のサムネイルやリンクを非表示にする | `true` |
| `SHORTS_REDIRECT_URL` | Shorts にアクセスした際のリダイレクト先（空文字でモーダル表示） | `"/feed/subscriptions"` |
| `SHOW_WATCH_OVERLAY` | 右上の視聴時間オーバーレイを表示する | `true` |
| `ENABLE_SUMMARY_PANEL` | 集計パネル（履歴テーブル）を有効にする | `true` |

設定変更後はスクリプトを保存し、YouTube を再読み込みすると反映されます。

## 保存されるデータ
すべてのデータはブラウザの `localStorage` に保存され、外部へ送信されません。

| 保存キー | 内容 |
| --- | --- |
| `yt_reason_store_v1` | 動画ごとの入力理由とカテゴリ、記録時刻、URL |
| `yt_reason_daily_v1` | 日別の視聴時間（合計／学習／娯楽／その他） |
| `yt_reason_approved_v1` | 再入力を省略してよい動画の承認フラグ |

リセットしたい場合はブラウザの開発者ツールで `localStorage.removeItem('<キー>')` を実行するか、該当ドメインのローカルストレージを削除してください。

## 既知の制限
- オフライン再生や他の拡張機能が動画の再生を制御している場合、カウントが正しく行われない可能性があります。
- YouTube 側の大幅な UI 変更が入った場合、モーダルや UI の挙動に影響が出ることがあります。

## ライセンス
スクリプトと同じライセンスを参照してください（必要に応じて追記）。
